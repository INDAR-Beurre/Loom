<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="LoomBrowser.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
    Title="Loom - Home"
    Background="{DynamicResource WindowBackground}"
    WindowStyle="None"
    AllowsTransparency="True"
    Width="1200"
    Height="800">

    <Window.Resources>
        <DropShadowEffect x:Key="DropShadowEffect" Color="#000000" BlurRadius="22" ShadowDepth="0" Opacity="0.22" />
        <DropShadowEffect x:Key="HomeSearchShadow" Color="#082b16" BlurRadius="24" ShadowDepth="0" Opacity="0.18" />
    </Window.Resources>

    <Grid>
        <!-- outer rounded window chrome -->
        <Border CornerRadius="10" Background="{DynamicResource WindowBackground}" SnapsToDevicePixels="True" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Toolbar / Titlebar -->
                <Border Grid.Row="0" Height="120" Background="{StaticResource PanelAccent}" Padding="8" CornerRadius="8" BorderBrush="#083020" BorderThickness="0,0,0,1">
            <DockPanel LastChildFill="True">
                <!-- custom title area for window chrome -->
                <Grid DockPanel.Dock="Top" Height="38" Margin="6" VerticalAlignment="Top">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal" Grid.Column="0" VerticalAlignment="Center" Margin="8,0">
                        <TextBlock Text="Loom" Style="{StaticResource WindowTitle}" Margin="0,0,8,0" />
                        <TextBlock Text="â€¢" Foreground="{StaticResource PrimaryGreen}" VerticalAlignment="Center" Margin="2,0" />
                    </StackPanel>
                    <Grid Grid.Column="1" MouseDown="TitleBar_MouseDown" />
                    <StackPanel Orientation="Horizontal" Grid.Column="2" HorizontalAlignment="Right">
                        <Button Click="Minimize_Click" Width="38" Height="28" Margin="6,0" Style="{StaticResource RoundedButton}">â€”</Button>
                        <Button Click="Maximize_Click" Width="38" Height="28" Margin="6,0" Style="{StaticResource RoundedButton}">â—»</Button>
                        <Button Click="Close_Click" Width="38" Height="28" Margin="6,0" Style="{StaticResource RoundedButton}">âœ•</Button>
                    </StackPanel>
                </Grid>
                <!-- Tabs area -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" HorizontalAlignment="Left" Height="40">
                    <ItemsControl x:Name="TabsPresenter" ItemsSource="{Binding Tabs}" HorizontalAlignment="Left">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="4">
                                    <Button Click="SelectTab_Click" Tag="{Binding Id}" Background="#191E24" Foreground="White" Padding="8,4" Content="{Binding Title}"/>
                                    <Button Click="CloseTab_Click" Tag="{Binding Id}" Content="âœ•" Margin="6,0,0,0" Padding="2" Background="Transparent" Foreground="White" BorderThickness="0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Button Click="NewTab_Click" Content="ï¼‹" Width="36" Height="36" Margin="8,4" Style="{StaticResource RoundedButton}" />
                </StackPanel>

                <!-- Address/Search bar -->
                <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Width="760">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Height="46" CornerRadius="22" Style="{StaticResource SearchContainer}" VerticalAlignment="Center">
                        <DockPanel>
                            <TextBlock Text="ðŸ”" VerticalAlignment="Center" Margin="8,0" Foreground="#9fe3a7" />
                            <TextBox x:Name="AddressBox" Width="540" Height="28" Padding="8" VerticalAlignment="Center" Background="Transparent" BorderThickness="0" Foreground="#d8ffd7" KeyDown="AddressBox_KeyDown"/>
                        </DockPanel>
                    </Border>

                    <Button Grid.Column="1" x:Name="GoButton" Content="Go" Width="64" Height="36" Margin="8,0" Click="GoButton_Click" Style="{StaticResource RoundedButton}" VerticalAlignment="Center"/>
                    <Button Grid.Column="2" Content="â‹®" Width="36" Height="36" Margin="8,0,0,0" Click="OpenMenu_Click" Style="{StaticResource RoundedButton}"/>
                </Grid>

                <!-- Actions right side -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="8,0">
                    <Button x:Name="AiToggleButton" Content="AI" Width="56" Height="36" Click="ToggleAI_Click" Style="{StaticResource RoundedButton}" />
                    <Button x:Name="AccountButton" Content="Account" Width="84" Height="36" Margin="6,0" Click="OpenAccount_Click" Style="{StaticResource RoundedButton}" />
                    <Button Content="â‹®" Width="36" Height="36" Click="OpenMenu_Click" Style="{StaticResource RoundedButton}" />
                </StackPanel>
            </DockPanel>
        </Border>

            <!-- Content area -->
            <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="320" />
            </Grid.ColumnDefinitions>

            <!-- Main content (home / search / site) -->
            <Border Grid.Column="0" Background="#072a17" CornerRadius="6" Margin="12" Padding="8">
                <ContentControl x:Name="MainContentHost" />
            </Border>

            <!-- Right column: AI assistant placeholder -->
            <Border x:Name="AiPanel" Grid.Column="1" Background="{StaticResource PanelAccent}" Margin="12" CornerRadius="8" Padding="12" BorderBrush="#0b3c2a" BorderThickness="1" Visibility="Collapsed">
                <StackPanel>
                    <TextBlock Text="Loom AI" Foreground="White" FontWeight="Bold" FontSize="16" />
                    <TextBlock Text="(Assistant panel)" Foreground="#B0B0B0" Margin="0,8,0,12" />
                    <TextBox x:Name="AIInput" Height="36" AcceptsReturn="False" Style="{StaticResource RoundedTextBox}" />
                    <Button Content="Send" Width="84" Height="36" Margin="0,8,0,0" Click="AI_Send_Click" Style="{StaticResource RoundedButton}" />
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="0,12,0,0">
                        <StackPanel x:Name="AIMessageStack" />
                    </ScrollViewer>
                </StackPanel>
            </Border>
                </Grid>
            </Grid>
        </Border>

    </Grid>
</Window>